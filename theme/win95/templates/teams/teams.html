{% extends "base.html" %}

{% block content %}
<div class="window win95-window" data-window-id="teams" data-window-title="Network Neighborhood" style="--win95-top: 90px; --win95-left: 140px; --win95-width: min(980px, 92vw); --win95-height: min(540px, 70vh);" role="dialog" aria-label="Teams">
  <div class="title-bar">
    <div class="title-bar-text">Network Neighborhood</div>
    <div class="title-bar-controls">
      <button type="button" data-action="minimize" aria-label="Minimize"></button>
      <button type="button" data-action="close" aria-label="Close"></button>
    </div>
  </div>
  <div class="window-body">
    <div class="window-toolbar">
      <strong>Find team:</strong>
    </div>

    {% if q and field %}
      <p>Searching for teams with <strong>{{ field }}</strong> matching <strong>{{ q }}</strong></p>
      <p>Page {{ teams.page }} of {{ teams.total }} results</p>
    {% endif %}

    {% with form = Forms.teams.PublicTeamSearchForm(field=field, q=q) %}
      <form method="GET" class="search-form">
        <div>
          <strong>Filter field</strong>
          {{ form.field(class="win95-input") }}
        </div>
        <div>
          <strong>Search</strong>
          {{ form.q(class="win95-input", placeholder="Search for matching teams") }}
        </div>
        <div>
          <button type="submit">Search</button>
        </div>
      </form>
    {% endwith %}

    {% set team_items = teams.items if teams.items is defined else teams %}
    <div class="list-view">
      <table>
        <thead>
          <tr>
            <th>Team</th>
            <th>Website</th>
            <th class="d-none d-md-table-cell">Affiliation</th>
            <th class="d-none d-md-table-cell">Country</th>
          </tr>
        </thead>
        <tbody>
          {% for team in team_items %}
            <tr>
              <td>
                {% if scores_visible() %}
                  <a href="{{ url_for('teams.public', team_id=team.id) }}">{{ team.name | truncate(50) }}</a>
                {% else %}
                  <span>{{ team.name | truncate(50) }}</span>
                {% endif %}
                {% if team.bracket_id %}
                  <span class="badge">{{ team.bracket.name }}</span>
                {% endif %}
              </td>
              <td>
                {% if team.website and (team.website.startswith('http://') or team.website.startswith('https://')) %}
                  <a href="{{ team.website }}" target="_blank" rel="noopener">Visit</a>
                {% endif %}
              </td>
              <td class="d-none d-md-table-cell">{{ team.affiliation | default("", true) | truncate(50) }}</td>
              <td class="d-none d-md-table-cell">
                {% if team.country %}
                  {{ lookup_country_code(team.country) }}
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      {% if team_items | length == 0 %}
        <p>No teams found.</p>
      {% endif %}
    </div>

    {% if teams.pages > 1 %}
      <div class="status-bar">
        Page
        {% if teams.page != 1 %}
          <a href="{{ prev_page }}">&lt;&lt;&lt;</a>
        {% endif %}
        <select class="page-select">
          {% for page in range(1, teams.pages + 1) %}
            <option {% if teams.page == page %}selected{% endif %}>{{ page }}</option>
          {% endfor %}
        </select>
        {% if teams.next_num %}
          <a href="{{ next_page }}">&gt;&gt;&gt;</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  <div class="resize-handle" aria-hidden="true"></div>
</div>
{% endblock %}

{% block scripts %}
  {{ Assets.js("assets/js/teams/list.js", theme="core") }}
  {{ super() }}
{% endblock %}
